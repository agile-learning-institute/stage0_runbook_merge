$schema: "https://stage0/schemas/process.schema.yaml"
$id: "https://stage0/template-ts-mongo-express-api/process.yaml"
title: Process file for a typescript, mongo-backed, express based restful API
version: "1.0"

environment:
  - SERVICE_NAME: specifies a service name for context
  - DOCUMENT_SCHEMA: document schema file-name for context

context:
  - key: service
    type: selector
    path: specifications.architecture.domains
    filter:
      property: name
      value: SERVICE_NAME
  - key: document
    type: property
    path: specifications.dataDefinitions
    property: DOCUMENT_SCHEMA
  - key: architecture
    type: path
    path: specifications.architecture

requires:
  - service.data.sources
  - service.data.sinks
  - document.properties
  - architecture.product
  - architecture.product-name
  - architecture.product-description
  - architecture.organization
  - architecture.organization-name

templates:
  - path: "./simple.md"
    merge: true
  - path: "./loop-in.ts"
    merge: true
  - path: "./source"
    mergeFor: 
      items: service.data.sources
      output: "./{{item.name}}Service.ts"

